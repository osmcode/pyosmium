#-----------------------------------------------------------------------------
#
#  Configuration for continuous integration service at travis-ci.org
#
#-----------------------------------------------------------------------------

language: cpp

dist: xenial

matrix:
    include:
        - os: linux
          compiler: clang
          env: USE_PYTHON_VERSION=2
        - os: linux
          compiler: clang
          env: USE_PYTHON_VERSION=3
        - os: linux
          compiler: gcc
          env: USE_PYTHON_VERSION=2
        - os: linux
          compiler: gcc
          env: USE_PYTHON_VERSION=3
        - os: osx
          osx_image: xcode7
          compiler: clang
          env: USE_PYTHON_VERSION=
        - os: osx
          osx_image: xcode10.1
          compiler: clang
          env: USE_PYTHON_VERSION=
        - os: osx
          osx_image: xcode10.1
          compiler: clang
          env: USE_PYTHON_VERSION=3

# http://docs.travis-ci.com/user/apt/
addons:
    apt:
        sources:
            - boost-latest
        packages:
            - libboost1.58-dev
            - python-dev
            - python3
            - python3-dev
            - python3-setuptools

install:
    - git clone --quiet --depth 1 https://github.com/osmcode/libosmium.git contrib/libosmium
    - git clone --quiet --depth 1 https://github.com/mapbox/protozero.git contrib/protozero
    - git clone --quiet --depth 1 https://github.com/pybind/pybind11.git contrib/pybind11
    - if [[ $TRAVIS_OS_NAME == 'osx' ]]; then pip${USE_PYTHON_VERSION}  install -U virtualenv ; fi
    - virtualenv -p python${USE_PYTHON_VERSION} build_env
    - virtualenv -p python${USE_PYTHON_VERSION} test_env
    - build_env/bin/pip install -q -r build-requirements.txt
    - test_env/bin/pip install -q -r test-requirements.txt

script:
    - build_env/bin/python --version
    - build_env/bin/python setup.py build
    - cd test
    - ../test_env/bin/python run_tests.py

